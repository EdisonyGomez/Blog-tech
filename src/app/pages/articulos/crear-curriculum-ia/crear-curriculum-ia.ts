import { Breadcrumbs } from './../../../shared/breadcrumbs/breadcrumbs';
import { Navbar } from './../../../shared/navbar/navbar';
import { ScrollService } from './../../../services/scroll.service';
import { Component,  OnInit } from "@angular/core"
import { CommonModule } from "@angular/common"
import { RouterModule,  Router } from "@angular/router"
import { FormsModule } from "@angular/forms"
import  { Location } from "@angular/common"
import { trigger, style, animate, transition, stagger, query, keyframes } from "@angular/animations"

interface CVAnalysis {
  score: number
  strengths: string[]
  improvements: string[]
  recommendations: string[]
  keywords: string[]
}

@Component({
  selector: "app-crear-curriculum-ia",
  imports: [CommonModule, RouterModule, FormsModule, Navbar, Breadcrumbs],
  templateUrl: "./crear-curriculum-ia.html",
  standalone: true,
  animations: [
    trigger("fadeInUp", [
      transition(":enter", [
        style({ opacity: 0, transform: "translateY(30px)" }),
        animate("600ms ease-out", style({ opacity: 1, transform: "translateY(0)" })),
      ]),
    ]),
    trigger("staggerIn", [
      transition("* => *", [
        query(
          ":enter",
          [
            style({ opacity: 0, transform: "translateY(20px)" }),
            stagger(100, [animate("400ms ease-out", style({ opacity: 1, transform: "translateY(0)" }))]),
          ],
          { optional: true },
        ),
      ]),
    ]),
    trigger("slideInScale", [
      transition(":enter", [
        style({ opacity: 0, transform: "scale(0.8)" }),
        animate("500ms ease-out", style({ opacity: 1, transform: "scale(1)" })),
      ]),
    ]),
    trigger("bounceIn", [
      transition(":enter", [
        animate(
          "800ms ease-out",
          keyframes([
            style({ opacity: 0, transform: "scale(0.3)", offset: 0 }),
            style({ opacity: 1, transform: "scale(1.05)", offset: 0.5 }),
            style({ opacity: 1, transform: "scale(0.95)", offset: 0.7 }),
            style({ opacity: 1, transform: "scale(1)", offset: 1 }),
          ]),
        ),
      ]),
    ]),
  ],
})
export class CrearCurriculumIa implements OnInit {
  emailSubscription = ""

  // Simulador variables
  experienceLevel = "mid"
  desiredRole = ""
  selectedSector = "tecnologia"
  cvAnalysis: CVAnalysis | null = null
  isAnalyzing = false

  breadcrumbItems = [
    { label: "Inicio", route: "/" },
    { label: "Art√≠culos", route: "/articulos" },
    { label: "Crear curr√≠culum con IA", active: true },
  ]

  experienceLevels = [
    { value: "junior", label: "üë∂ Junior (0-2 a√±os)", color: "bg-green-100 text-green-700" },
    { value: "mid", label: "üöÄ Mid-level (2-5 a√±os)", color: "bg-blue-100 text-blue-700" },
    { value: "senior", label: "‚≠ê Senior (5+ a√±os)", color: "bg-purple-100 text-purple-700" },
  ]

  sectors = [
    { value: "tecnologia", label: "üíª Tecnolog√≠a" },
    { value: "salud", label: "üè• Salud" },
    { value: "educacion", label: "üìö Educaci√≥n" },
    { value: "finanzas", label: "üí∞ Finanzas" },
    { value: "marketing", label: "üìà Marketing" },
    { value: "ventas", label: "üéØ Ventas" },
    { value: "diseno", label: "üé® Dise√±o" },
    { value: "recursos-humanos", label: "üë• Recursos Humanos" },
    { value: "ingenieria", label: "‚öôÔ∏è Ingenier√≠a" },
    { value: "otros", label: "üåü Otros" },
  ]

  tools = [
    {
      name: "ChatGPT",
      description: "Generar contenido, reformular logros, ideas de dise√±o",
      icon: "ü§ñ",
      url: "https://chat.openai.com",
      category: "Contenido",
      features: ["Res√∫menes profesionales", "Reformulaci√≥n de logros", "Cartas de presentaci√≥n"],
    },
    {
      name: "Rezi AI",
      description: "Crear CV optimizado para ATS (sistemas de reclutamiento)",
      icon: "üéØ",
      url: "https://rezi.ai",
      category: "Optimizaci√≥n ATS",
      features: ["An√°lisis ATS", "Palabras clave", "Formato optimizado"],
    },
    {
      name: "Resume.io",
      description: "Dise√±ar tu CV visualmente (plantillas modernas)",
      icon: "üìÑ",
      url: "https://resume.io",
      category: "Dise√±o",
      features: ["Plantillas profesionales", "Editor visual", "Exportaci√≥n PDF"],
    },
    {
      name: "Canva AI",
      description: "Dise√±os creativos r√°pidos con IA",
      icon: "üé®",
      url: "https://canva.com",
      category: "Dise√±o Creativo",
      features: ["Templates √∫nicos", "IA generativa", "Elementos visuales"],
    },
  ]

  // Prompts para copiar
  prompts = {
    resumenProfesional:
      "Redacta un resumen profesional para alguien con experiencia en [tu √°rea], que quiere postular a una empresa [tipo de empresa] en el √°rea de [√°rea espec√≠fica].",
    logrosMediables: "Convierte esta frase en un logro medible y profesional: '[describe tu tarea o responsabilidad]'",
    cvCompleto:
      "Crea un curr√≠culum para una persona con [X a√±os] de experiencia en [tu √°rea], que busca empleo [remoto/presencial] en [tipo de empresa]. Incluye resumen, experiencia laboral, habilidades y formaci√≥n.",
    optimizacionATS:
      "Analiza esta descripci√≥n de puesto y sugiere palabras clave que deber√≠a incluir en mi CV: [pegar descripci√≥n del puesto]",
  }

  constructor(
    private router: Router,
    private location: Location,
    private scrollService: ScrollService,
  ) {}

  ngOnInit() {
    this.scrollService.scrollToTop()
  }

  goBack(): void {
    this.location.back()
  }

  toggleBookmark(): void {
    console.log("Bookmark toggled")
  }

  shareArticle(): void {
    if (navigator.share) {
      navigator.share({
        title: "C√≥mo crear tu curr√≠culum con inteligencia artificial",
        text: "Aprende a crear un CV profesional y optimizado usando herramientas de IA",
        url: window.location.href,
      })
    } else {
      navigator.clipboard.writeText(window.location.href)
      alert("URL copiada al portapapeles")
    }
  }

  copyPrompt(prompt: string): void {
    navigator.clipboard.writeText(prompt).then(() => {
      console.log("Prompt copiado")
    })
  }

  subscribeNewsletter(): void {
    if (this.emailSubscription) {
      console.log("Suscribiendo:", this.emailSubscription)
      this.emailSubscription = ""
    }
  }

  // Simulador de an√°lisis de CV
  analyzeCv(): void {
    if (!this.desiredRole.trim()) {
      alert("Por favor, especifica el rol al que aspiras para analizar tu perfil.")
      return
    }

    this.isAnalyzing = true

    // Simular an√°lisis de IA
    setTimeout(() => {
      this.cvAnalysis = this.generateCvAnalysis(this.experienceLevel, this.desiredRole, this.selectedSector)
      this.isAnalyzing = false
    }, 2500)
  }

  private generateCvAnalysis(experience: string, role: string, sector: string): CVAnalysis {
    const sectorData = {
      tecnologia: {
        keywords: ["JavaScript", "Python", "React", "Node.js", "AWS", "Git", "Agile", "API"],
        skills: ["programaci√≥n", "desarrollo web", "bases de datos", "cloud computing"],
      },
      salud: {
        keywords: ["pacientes", "diagn√≥stico", "tratamiento", "protocolos", "seguridad", "calidad"],
        skills: ["atenci√≥n al paciente", "conocimientos m√©dicos", "trabajo en equipo", "comunicaci√≥n"],
      },
      marketing: {
        keywords: ["SEO", "SEM", "Google Analytics", "redes sociales", "conversi√≥n", "ROI", "campa√±as"],
        skills: ["an√°lisis de datos", "creatividad", "comunicaci√≥n", "estrategia digital"],
      },
      finanzas: {
        keywords: ["an√°lisis financiero", "Excel", "presupuestos", "inversiones", "riesgo", "compliance"],
        skills: ["an√°lisis cuantitativo", "atenci√≥n al detalle", "normativas", "reporting"],
      },
      diseno: {
        keywords: ["Adobe", "Figma", "UI/UX", "branding", "tipograf√≠a", "color", "composici√≥n"],
        skills: ["creatividad", "software de dise√±o", "comunicaci√≥n visual", "tendencias"],
      },
      ventas: {
        keywords: ["CRM", "prospecci√≥n", "negociaci√≥n", "cierre", "KPIs", "pipeline", "clientes"],
        skills: ["comunicaci√≥n", "persuasi√≥n", "orientaci√≥n a resultados", "networking"],
      },
      educacion: {
        keywords: ["pedagog√≠a", "curr√≠culo", "evaluaci√≥n", "metodolog√≠as", "tecnolog√≠a educativa"],
        skills: ["ense√±anza", "paciencia", "comunicaci√≥n", "adaptabilidad", "liderazgo"],
      },
      "recursos-humanos": {
        keywords: ["reclutamiento", "selecci√≥n", "n√≥mina", "capacitaci√≥n", "evaluaci√≥n", "compliance"],
        skills: ["comunicaci√≥n", "confidencialidad", "organizaci√≥n", "negociaci√≥n", "empat√≠a"],
      },
      ingenieria: {
        keywords: ["CAD", "proyectos", "calidad", "procesos", "normativas", "optimizaci√≥n"],
        skills: ["resoluci√≥n de problemas", "an√°lisis t√©cnico", "trabajo en equipo", "precisi√≥n"],
      },
      otros: {
        keywords: ["liderazgo", "comunicaci√≥n", "organizaci√≥n", "resultados", "eficiencia"],
        skills: ["adaptabilidad", "trabajo en equipo", "orientaci√≥n a resultados", "comunicaci√≥n"],
      },
    }

    const data = sectorData[sector as keyof typeof sectorData] || sectorData.otros

    const experienceAnalysis = {
      junior: {
        score: 65,
        strengths: ["Energ√≠a y ganas de aprender", "Conocimientos actualizados", "Flexibilidad"],
        improvements: [
          "Agregar m√°s proyectos personales o acad√©micos",
          "Destacar habilidades t√©cnicas espec√≠ficas",
          "Incluir certificaciones relevantes",
        ],
      },
      mid: {
        score: 78,
        strengths: ["Experiencia pr√°ctica s√≥lida", "Balance entre t√©cnico y soft skills", "Historial comprobado"],
        improvements: [
          "Cuantificar mejor los logros obtenidos",
          "Agregar ejemplos de liderazgo o mentor√≠a",
          "Incluir impacto en resultados de negocio",
        ],
      },
      senior: {
        score: 85,
        strengths: ["Amplia experiencia", "Liderazgo demostrado", "Visi√≥n estrat√©gica"],
        improvements: [
          "Enfocar en logros de alto impacto",
          "Destacar equipos liderados y resultados",
          "Incluir reconocimientos o premios",
        ],
      },
    }

    const expData = experienceAnalysis[experience as keyof typeof experienceAnalysis]

    return {
      score: expData.score,
      strengths: expData.strengths,
      improvements: expData.improvements,
      recommendations: [
        `Incluye palabras clave espec√≠ficas de ${this.getSectorLabel(sector)}`,
        `Adapta tu resumen profesional para roles de ${role}`,
        "Usa n√∫meros y m√©tricas en tus logros",
        "Optimiza el formato para sistemas ATS",
      ],
      keywords: data.keywords.slice(0, 6),
    }
  }

  private getSectorLabel(sector: string): string {
    const sectorObj = this.sectors.find((s) => s.value === sector)
    return sectorObj ? sectorObj.label.split(" ")[1] : "tu sector"
  }

  resetAnalyzer(): void {
    this.experienceLevel = "mid"
    this.desiredRole = ""
    this.selectedSector = "tecnologia"
    this.cvAnalysis = null
  }

  scrollToAnalyzer(): void {
    document.getElementById("cv-analyzer")?.scrollIntoView({
      behavior: "smooth",
    })
  }
}
